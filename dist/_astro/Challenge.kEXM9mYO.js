import{j as s}from"./jsx-runtime.vlAWDSmm.js";import{n as Y}from"./router.B-sij-_X.js";import{r as n}from"./index.BwNzhqGF.js";import{c as $}from"./index.BQXz43h1.js";import{s as G}from"./pathHelpers.kwYD5byA.js";import{g as M,Q as A}from"./QuestionStore.DoXL2Hea.js";import{c as S}from"./clsx.B-dksMZM.js";import"./_commonjsHelpers.Cpj98o6Y.js";const X=n.createContext({answers:[],setAnswers:()=>{},currentChallenge:0,setCurrentChallenge:()=>{},totalQuestions:0,setTotalQuestions:()=>{},correctAnswers:0,setCorrectAnswers:()=>{}}),u=M();function ne({children:p,title:a,group:l,question:i,options:f,explanation:m,index:c}){let t=null;const y="DanLevy.net",{setTotalQuestions:v,setCorrectAnswers:z}=n.useContext(X),w=n.useRef(null),[d,x]=n.useState("untouched"),[C,k]=n.useState(void 0),[N,b]=n.useState(!1),[E,Q]=n.useState(m),[L,T]=n.useState(0),[P,R]=n.useState(""),_=()=>{const e=document.querySelectorAll("main .challenge"),r=document.querySelectorAll("main .challenge.correct");v(e?.length),z(r?.length),window?.__updateCounts()};n.useEffect(()=>{t||(t=A(u?.location.pathname));const e=u?.location?.pathname??"";R(y+e)},[u?.location?.pathname]),n.useEffect(()=>{if(t||(t=A(u?.location.pathname)),t){t.addQuestion({title:a,group:l,question:i,index:c});const e=t?.isCorrect({index:c})??void 0,r=t?.getTries({index:c})??0;T(r),k(e),x(e===!0?"correct":e===!1?"incorrect":"")}else console.error("QuestionStore is not initialized")},[t,a,l,i,f,m]);const H=(e,r)=>{const h=u?.posthog;h&&h.capture(e,r)},O=e=>{t||(t=A(u?.location.pathname)),t?.answerQuestion({index:c},e),T(t.sumOfTries()),e.isAnswer?(k(!0),x("correct pulse")):(k(!1),x("incorrect shake")),H("QuizAnswer",{isCorrect:e.isAnswer,option:e,question:i||"",title:a,questionIndex:c}),setTimeout(_,20)};n.useEffect(()=>{const e=d.includes("shake")||d.includes("pulse");if(d&&e){const r=d.split(" ").filter(h=>!["shake","pulse"].includes(h));setTimeout(()=>{x(r.join(" "))},1e3)}},[d]),n.useEffect(()=>{if(w.current){const e=w.current.querySelector("div.explanation")?.innerHTML;e&&Q(e)}},[E]);const j=(c??0)+1;f.filter(e=>e.isAnswer).length===0&&console.error("No correct answers found for question:",i,a,f);const q=f.map(e=>{const r=C&&e.isAnswer;return C&&!e.isAnswer?null:s.jsx("a",{className:$("option",{"correct-answer":r}),onClick:()=>!C&&O(e),children:s.jsx("label",{children:e.text})},e.text)}).filter(Boolean);return s.jsxs("div",{id:`qq-${j}`,className:S("challenge",d),ref:w,"data-answer-count":L,"data-question-correct":C,children:[s.jsxs("div",{className:"quiz-header",children:[s.jsxs("div",{className:"quiz-question-count",children:[s.jsxs("a",{href:`#qq-${j}`,children:[j,"."]}),"Â "]}),s.jsx("h2",{className:"quiz-title",id:G(a),children:l})]}),s.jsx("div",{className:"quiz-question",children:i||p}),s.jsxs("aside",{className:"quiz-hint-toggle",children:[s.jsx("div",{className:"watermark",children:P}),s.jsxs("button",{onClick:()=>b(!N),className:S("toggle-explainer",{open:N}),children:[N?"Hide":"Show"," Explainer"," "]})]}),s.jsxs("section",{className:S("quiz-body-panel","card-container",{"card-flip":N}),style:{height:`${70*q.length}px`,transition:"height 0.2s ease-in-out",overflowY:"auto"},children:[s.jsx("section",{className:"quiz-options card card-front",children:q}),s.jsx("section",{className:"explanation card card-back ",children:s.jsx("p",{className:"help-box",dangerouslySetInnerHTML:{__html:E},onClick:e=>{e.preventDefault();const{clientX:r,clientY:h}=e,o=e.target;console.log("Clicked on explanation",{clientX:r,clientY:h},o.tagName,o.getAttributeNames());const g=o.tagName==="A"?o:o?.parentElement?.tagName==="A"?o.parentElement:null,B=F({target:o},48),D=o.closest("code, pre"),V=o.closest("p");if(B)return console.log("TOP RIGHT CLOSE"),b(!1),!1;if(V)return console.log("Clicked in paragraph %o",o),!1;if(D)return console.log("Clicked in code block %o",o),!1;if(g)return Y(g.href,{sourceElement:g}),console.log("Clicked on link",g,g?.href),!0}})})]})]})}function F({target:p},a=48){if(!p)return!1;const l=getComputedStyle(p,"::before"),{scrollY:i,scrollX:f}=u;if(l){const m=Number(l.getPropertyValue("top").slice(0,-2)),c=Number(l.getPropertyValue("right").slice(0,-2)),t=Number(l.getPropertyValue("left").slice(0,-2));if(Number.isNaN(c)||Number.isNaN(m))return!1;if(console.log("isBefore %o %o",{top:m,right:c,left:t,scrollX:f,scrollY:i}),m<=a&&c<=a)return!0}return!1}export{ne as default};

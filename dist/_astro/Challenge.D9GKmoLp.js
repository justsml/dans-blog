import{j as t}from"./jsx-runtime.D3GSbgeI.js";import{n as X}from"./router.D_yf6EMa.js";import{r}from"./index.CfUZTxxr.js";import{c as J}from"./index.Dm2aAYFu.js";import{s as K}from"./pathHelpers.kwYD5byA.js";import{g as U,Q as v}from"./QuestionStore.DE3R8U0_.js";import{B as P}from"./index.rGIp_gDY.js";import{P as Z,a as ee,b as te}from"./popover.Aa7CwoEO.js";import{a as se,c as q}from"./index.BvS0xTV7.js";import{usePostHog as ne}from"./PostHogEntry.Duc4KoG5.js";import"./index.yBjzXJbu.js";import"./_commonjsHelpers.Cpj98o6Y.js";import"./index.BbTPjBLC.js";import"./preload-helper.BlTxHScW.js";const re=r.createContext({answers:[],setAnswers:()=>{},currentChallenge:0,setCurrentChallenge:()=>{},totalQuestions:0,setTotalQuestions:()=>{},correctAnswers:0,setCorrectAnswers:()=>{}});function oe({hint:m,className:l,title:o,showHint:u,onClose:i}){return u&&console.log(`Showing Hint: ${m}`),t.jsxs(Z,{"data-align":"end",open:u,onOpenChange:a=>{a||i?.()},children:[t.jsx(ee,{}),t.jsx(te,{className:se("w-80 opacity-90 hint-tooltip",l),children:t.jsxs("div",{className:"grid gap-4",onClick:a=>{a.stopPropagation(),a.preventDefault(),i?.()},children:[t.jsxs("div",{className:"inner-tooltip grid",children:[o&&t.jsx("h4",{className:"font-medium leading-none my-2",children:o}),t.jsx("p",{className:"text-sm text-muted-foreground my-0",children:m})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(P,{onClick:()=>i?.(),variant:"outline",children:"Dismiss"}),t.jsx(P,{onClick:()=>i?.(5),variant:"outline",children:"Hide next 5 Hints"})]})]})})]})}const p=U(),ie=1.75;function ke({children:m,title:l,group:o,question:u,options:i,explanation:a,index:f}){let n=null;const Q="DanLevy.net",{setTotalQuestions:L,setCorrectAnswers:O}=r.useContext(re),g=r.useRef(null),[d,N]=r.useState("untouched"),[C,k]=r.useState(void 0),[w,E]=r.useState(!1),[H,R]=r.useState(a),[D,b]=r.useState(0),[B,$]=r.useState(""),F=()=>{const e=document.querySelectorAll("main .challenge"),c=document.querySelectorAll("main .challenge.correct");L(e?.length),O(c?.length),window?.__updateCounts()};r.useEffect(()=>{n||(n=v(p?.location.pathname));const e=p?.location?.pathname??"";$(Q+e)},[p?.location?.pathname]),r.useEffect(()=>{if(n||(n=v(p?.location.pathname)),n){n.addQuestion({title:l,group:o,question:u,index:f});const e=n?.isCorrect({index:f})??void 0,c=n?.getTries({index:f})??0;b(c),k(e),N(e===!0?"correct":e===!1?"incorrect":"")}else console.error("QuestionStore is not initialized")},[n,l,o,u,i,a]);const{posthog:y}=ne(),V=(e,c)=>{y&&y.capture(e,c)},Y=1,[T,A]=r.useState(!1),[j,_]=r.useState(Y),G=e=>{n||(n=v(p?.location.pathname)),n?.answerQuestion({index:f},e),b(n.sumOfTries()),A(!1),e.isAnswer?(N("correct pulse"),k(!0)):(N("incorrect shake"),k(!1),j>0&&(console.log("Decrementing ignoreHintBy",j),_(j-1)),e.hint&&j<1&&A(e.hint)),V("QuizAnswer",{isCorrect:e.isAnswer,option:e,question:u||"",title:l,questionIndex:f}),setTimeout(F,20)};r.useEffect(()=>{const e=d.includes("shake")||d.includes("pulse");if(d&&e){const c=d.split(" ").filter(h=>!["shake","pulse"].includes(h));setTimeout(()=>{N(c.join(" "))},1e3)}},[d]),r.useEffect(()=>{if(g.current){const e=g.current.querySelector("div.explanation")?.innerHTML;e&&R(e)}requestAnimationFrame(()=>{const e=g.current?.querySelector?.(".quiz-options");e&&e&&window?.__superHackFix_patchOptionsListWithActualHeight&&window?.__superHackFix_patchOptionsListWithActualHeight([e])})},[H,g]);const S=(f??0)+1;i.filter(e=>e.isAnswer).length===0&&console.error("No correct answers found for question:",u,l,i);const z=i.map(e=>{const c=C&&e.isAnswer;if(C&&!e.isAnswer)return null;const h=e.hint===T?T:!1;return t.jsxs("a",{className:J("option",{"correct-answer":c},"mx-auto"),onClick:()=>!C&&G(e),children:[t.jsx("label",{children:e.text}),t.jsx(oe,{title:"ðŸ’¡ Hint",hint:h||"",showHint:!!h,onClose:s=>{s&&!isNaN(s)&&s>=1&&_(s),A(!1)}})]},e.text)}).filter(Boolean);return t.jsxs("div",{id:`qq-${S}`,className:q("challenge",d),ref:g,"data-answer-count":D,"data-question-correct":C,children:[t.jsxs("div",{className:"quiz-header",children:[t.jsxs("div",{className:"quiz-question-count",children:[t.jsxs("a",{href:`#qq-${S}`,children:[S,"."]}),"Â "]}),t.jsx("h2",{className:"quiz-title",id:K(l),children:t.jsx("a",{href:`#qq-${S}`,children:o})})]}),t.jsx("div",{className:"quiz-question",children:u||m}),t.jsxs("aside",{className:"quiz-hint-toggle",children:[t.jsx("div",{className:"watermark",children:B}),t.jsxs("button",{onClick:()=>E(!w),className:q("toggle-explainer",{open:w}),children:[w?"Hide":"Show"," Explainer"," "]})]}),t.jsxs("section",{className:q("quiz-body-panel","card-container",{"card-flip":w}),style:{height:`${ie*70*z.length}px`,transition:"height 0.2s ease-in-out",overflowY:"auto"},children:[t.jsx("section",{className:"quiz-options card card-front",children:z}),t.jsx("section",{className:"explanation card card-back ",children:t.jsx("p",{className:"help-box",dangerouslySetInnerHTML:{__html:H},onClick:e=>{e.preventDefault();const{clientX:c,clientY:h}=e,s=e.target;console.log("Clicked on explanation",{clientX:c,clientY:h},s.tagName,s.getAttributeNames());const x=s.tagName==="A"?s:s?.parentElement?.tagName==="A"?s.parentElement:null,I=ae({target:s},48),M=s.closest("code, pre"),W=s.closest("p");if(I)return E(!1),!1;if(W)return console.log("Clicked in paragraph %o",s),!1;if(M)return console.log("Clicked in code block %o",s),!1;if(x)return X(x.href,{sourceElement:x}),console.log("Clicked on link",x,x?.href),!0}})})]})]})}function ae({target:m},l=48){if(!m)return!1;const o=getComputedStyle(m,"::before"),{scrollY:u,scrollX:i}=p;if(o){const a=Number(o.getPropertyValue("top").slice(0,-2)),f=Number(o.getPropertyValue("right").slice(0,-2)),n=Number(o.getPropertyValue("left").slice(0,-2));if(Number.isNaN(f)||Number.isNaN(a))return!1;if(console.log("isBefore %o %o",{top:a,right:f,left:n,scrollX:i,scrollY:u}),a<=l&&f<=l)return!0}return!1}export{ke as default};

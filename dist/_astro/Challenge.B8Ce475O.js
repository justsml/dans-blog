import{j as s}from"./jsx-runtime.vlAWDSmm.js";import{r as n}from"./index.BwNzhqGF.js";import{c as $}from"./index.BQXz43h1.js";import{s as B}from"./pathHelpers.kwYD5byA.js";import{g as M,Q as w}from"./QuestionStore.DoXL2Hea.js";import{c as j}from"./clsx.B-dksMZM.js";import"./_commonjsHelpers.Cpj98o6Y.js";const O=n.createContext({answers:[],setAnswers:()=>{},currentChallenge:0,setCurrentChallenge:()=>{},totalQuestions:0,setTotalQuestions:()=>{},correctAnswers:0,setCorrectAnswers:()=>{}}),o=M();function W({children:E,title:i,group:x,question:l,options:u,explanation:N,index:a}){let t=null;const T="danlevy.net",{setTotalQuestions:v,setCorrectAnswers:z}=n.useContext(O),p=n.useRef(null),[c,d]=n.useState("untouched"),[h,g]=n.useState(void 0),[m,A]=n.useState(!1),[S,Q]=n.useState(N),[y,q]=n.useState(0),[b,_]=n.useState(""),L=()=>{const e=document.querySelectorAll("main .challenge"),r=document.querySelectorAll("main .challenge.correct");v(e?.length),z(r?.length),window?.__updateCounts()};n.useEffect(()=>{t||(t=w(o?.location.pathname));const e=o?.location?.pathname??"";_(T+e)},[o?.location?.pathname]),n.useEffect(()=>{if(t||(t=w(o?.location.pathname)),t){t.addQuestion({title:i,group:x,question:l,index:a});const e=t?.isCorrect({index:a})??void 0,r=t?.getTries({index:a})??0;q(r),g(e),d(e===!0?"correct":e===!1?"incorrect":"")}else console.error("QuestionStore is not initialized")},[t,i,x,l,u,N]);const H=(e,r)=>{const f=o?.posthog;f&&f.capture(e,r)},R=e=>{t||(t=w(o?.location.pathname)),t?.answerQuestion({index:a},e),q(t.sumOfTries()),e.isAnswer?(g(!0),d("correct pulse")):(g(!1),d("incorrect shake")),H("QuizAnswer",{isCorrect:e.isAnswer,option:e,question:l||"",title:i,questionIndex:a}),setTimeout(L,20)};n.useEffect(()=>{const e=c.includes("shake")||c.includes("pulse");if(c&&e){const r=c.split(" ").filter(f=>!["shake","pulse"].includes(f));setTimeout(()=>{d(r.join(" "))},1e3)}},[c]),n.useEffect(()=>{if(p.current){const e=p.current.querySelector("div.explanation")?.innerHTML;e&&Q(e)}},[S]);const C=(a??0)+1;u.filter(e=>e.isAnswer).length===0&&console.error("No correct answers found for question:",l,i,u);const k=u.map(e=>{const r=h&&e.isAnswer;return h&&!e.isAnswer?null:s.jsx("a",{className:$("option",{"correct-answer":r}),onClick:()=>!h&&R(e),children:s.jsx("label",{children:e.text})},e.text)}).filter(Boolean);return s.jsxs("div",{id:`qq-${C}`,className:j("challenge",c),ref:p,"data-answer-count":y,"data-question-correct":h,children:[s.jsxs("div",{className:"quiz-header",children:[s.jsxs("div",{className:"quiz-question-count",children:[s.jsxs("a",{href:`#qq-${C}`,children:[C,"."]}),"Â "]}),s.jsx("h2",{className:"quiz-title",id:B(i),children:x})]}),s.jsx("div",{className:"quiz-question",children:l||E}),s.jsxs("aside",{className:"quiz-hint-toggle",children:[s.jsx("div",{className:"watermark",children:b}),s.jsxs("button",{onClick:()=>A(!m),className:j("toggle-explainer",{open:m}),children:[m?"Hide":"Show"," Explainer"," "]})]}),s.jsxs("section",{className:j("quiz-body-panel","card-container",{"card-flip":m}),style:{height:`${80*k.length}px`,transition:"height 0.2s ease-in-out"},children:[s.jsx("section",{className:"quiz-options card card-front",children:k}),s.jsx("section",{className:"explanation card card-back ",children:s.jsx("p",{className:"help-box",dangerouslySetInnerHTML:{__html:S},onClick:()=>A(!1)})})]})]})}export{W as default};

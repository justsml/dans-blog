import{j as t}from"./jsx-runtime.D3GSbgeI.js";import{n as K}from"./router.D_yf6EMa.js";import{r as n}from"./index.CfUZTxxr.js";import{c as Z}from"./index.Dm2aAYFu.js";import{s as ee}from"./pathHelpers.kwYD5byA.js";import{g as te,Q as S}from"./QuestionStore.DE3R8U0_.js";import{B as R}from"./index.rGIp_gDY.js";import{P as se,a as ne,b as oe}from"./popover.Aa7CwoEO.js";import{a as re,c as y}from"./index.BvS0xTV7.js";import{_ as v}from"./preload-helper.BlTxHScW.js";import"./index.yBjzXJbu.js";import"./_commonjsHelpers.Cpj98o6Y.js";import"./index.BbTPjBLC.js";const ie=n.createContext({answers:[],setAnswers:()=>{},currentChallenge:0,setCurrentChallenge:()=>{},totalQuestions:0,setTotalQuestions:()=>{},correctAnswers:0,setCorrectAnswers:()=>{}});function ae({hint:i,className:a,title:s,showHint:c,onClose:l}){return c&&console.log(`Showing Hint: ${i}`),t.jsxs(se,{"data-align":"end",open:c,onOpenChange:u=>{u||l?.()},children:[t.jsx(ne,{}),t.jsx(oe,{className:re("w-80 opacity-90 hint-tooltip",a),children:t.jsxs("div",{className:"grid gap-4",onClick:u=>{u.stopPropagation(),u.preventDefault(),l?.()},children:[t.jsxs("div",{className:"inner-tooltip grid",children:[s&&t.jsx("h4",{className:"font-medium leading-none my-2",children:s}),t.jsx("p",{className:"text-sm text-muted-foreground my-0",children:i})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(R,{onClick:()=>l?.(),variant:"outline",children:"Dismiss"}),t.jsx(R,{onClick:()=>l?.(5),variant:"outline",children:"Hide next 5 Hints"})]})]})})]})}let w=!1,T=null;const ce=async()=>{if(w)return T;try{const{default:i}=await v(async()=>{const{default:a}=await import("./module.no-external.C1jtNZ3m.js");return{default:a}},[]);return await Promise.allSettled([v(()=>import("./exception-autocapture.D6r2eHOX.js"),[]),v(()=>import("./tracing-headers.BrYtQU45.js"),[]),v(()=>import("./web-vitals.BdZr08h8.js"),[])]).catch(console.warn),setTimeout(()=>{v(()=>import("./recorder.C9yNIxu9.js"),[]).catch(console.warn)},2e3),w=!0,T=i,i}catch(i){return console.warn("Analytics loading failed:",i),null}},le=()=>{const[i,a]=n.useState(w);return n.useEffect(()=>{if(!w){const s=()=>{ce().then(()=>{a(!0)}),document.removeEventListener("scroll",s),document.removeEventListener("click",s),document.removeEventListener("keydown",s)};document.addEventListener("scroll",s,{once:!0,passive:!0}),document.addEventListener("click",s,{once:!0}),document.addEventListener("keydown",s,{once:!0});const c=setTimeout(()=>{w||s()},3e3);return()=>{clearTimeout(c),document.removeEventListener("scroll",s),document.removeEventListener("click",s),document.removeEventListener("keydown",s)}}},[]),{posthog:T,isLoaded:i}},p=te(),ue=1.75;function Ae({children:i,title:a,group:s,question:c,options:l,explanation:u,index:m}){let r=null;const D="DanLevy.net",{setTotalQuestions:I,setCorrectAnswers:Q}=n.useContext(ie),g=n.useRef(null),[h,_]=n.useState("untouched"),[N,k]=n.useState(void 0),[C,L]=n.useState(!1),[q,V]=n.useState(u),[B,P]=n.useState(0),[$,F]=n.useState(""),Y=()=>{const e=document.querySelectorAll("main .challenge"),d=document.querySelectorAll("main .challenge.correct");I(e?.length),Q(d?.length),window?.__updateCounts()};n.useEffect(()=>{r||(r=S(p?.location.pathname));const e=p?.location?.pathname??"";F(D+e)},[p?.location?.pathname]),n.useEffect(()=>{if(r||(r=S(p?.location.pathname)),r){r.addQuestion({title:a,group:s,question:c,index:m});const e=r?.isCorrect({index:m})??void 0,d=r?.getTries({index:m})??0;P(d),k(e),_(e===!0?"correct":e===!1?"incorrect":"")}else console.error("QuestionStore is not initialized")},[r,a,s,c,l,u]);const{posthog:b}=le(),G=(e,d)=>{b&&b.capture(e,d)},M=1,[H,A]=n.useState(!1),[E,O]=n.useState(M),W=e=>{r||(r=S(p?.location.pathname)),r?.answerQuestion({index:m},e),P(r.sumOfTries()),A(!1),e.isAnswer?(_("correct pulse"),k(!0)):(_("incorrect shake"),k(!1),E>0&&(console.log("Decrementing ignoreHintBy",E),O(E-1)),e.hint&&E<1&&A(e.hint)),G("QuizAnswer",{isCorrect:e.isAnswer,option:e,question:c||"",title:a,questionIndex:m}),setTimeout(Y,20)};n.useEffect(()=>{const e=h.includes("shake")||h.includes("pulse");if(h&&e){const d=h.split(" ").filter(f=>!["shake","pulse"].includes(f));setTimeout(()=>{_(d.join(" "))},1e3)}},[h]),n.useEffect(()=>{if(g.current){const e=g.current.querySelector("div.explanation")?.innerHTML;e&&V(e)}requestAnimationFrame(()=>{const e=g.current?.querySelector?.(".quiz-options");e&&e&&window?.__superHackFix_patchOptionsListWithActualHeight&&window?.__superHackFix_patchOptionsListWithActualHeight([e])})},[q,g]);const j=(m??0)+1;l.filter(e=>e.isAnswer).length===0&&console.error("No correct answers found for question:",c,a,l);const z=l.map(e=>{const d=N&&e.isAnswer;if(N&&!e.isAnswer)return null;const f=e.hint===H?H:!1;return t.jsxs("a",{className:Z("option",{"correct-answer":d},"mx-auto"),onClick:()=>!N&&W(e),children:[t.jsx("label",{children:e.text}),t.jsx(ae,{title:"ðŸ’¡ Hint",hint:f||"",showHint:!!f,onClose:o=>{o&&!isNaN(o)&&o>=1&&O(o),A(!1)}})]},e.text)}).filter(Boolean);return t.jsxs("div",{id:`qq-${j}`,className:y("challenge",h),ref:g,"data-answer-count":B,"data-question-correct":N,children:[t.jsxs("div",{className:"quiz-header",children:[t.jsxs("div",{className:"quiz-question-count",children:[t.jsxs("a",{href:`#qq-${j}`,children:[j,"."]}),"Â "]}),t.jsx("h2",{className:"quiz-title",id:ee(a),children:t.jsx("a",{href:`#qq-${j}`,children:s})})]}),t.jsx("div",{className:"quiz-question",children:c||i}),t.jsxs("aside",{className:"quiz-hint-toggle",children:[t.jsx("div",{className:"watermark",children:$}),t.jsxs("button",{onClick:()=>L(!C),className:y("toggle-explainer",{open:C}),children:[C?"Hide":"Show"," Explainer"," "]})]}),t.jsxs("section",{className:y("quiz-body-panel","card-container",{"card-flip":C}),style:{height:`${ue*70*z.length}px`,transition:"height 0.2s ease-in-out",overflowY:"auto"},children:[t.jsx("section",{className:"quiz-options card card-front",children:z}),t.jsx("section",{className:"explanation card card-back ",children:t.jsx("p",{className:"help-box",dangerouslySetInnerHTML:{__html:q},onClick:e=>{e.preventDefault();const{clientX:d,clientY:f}=e,o=e.target;console.log("Clicked on explanation",{clientX:d,clientY:f},o.tagName,o.getAttributeNames());const x=o.tagName==="A"?o:o?.parentElement?.tagName==="A"?o.parentElement:null,X=de({target:o},48),U=o.closest("code, pre"),J=o.closest("p");if(X)return L(!1),!1;if(J)return console.log("Clicked in paragraph %o",o),!1;if(U)return console.log("Clicked in code block %o",o),!1;if(x)return K(x.href,{sourceElement:x}),console.log("Clicked on link",x,x?.href),!0}})})]})]})}function de({target:i},a=48){if(!i)return!1;const s=getComputedStyle(i,"::before"),{scrollY:c,scrollX:l}=p;if(s){const u=Number(s.getPropertyValue("top").slice(0,-2)),m=Number(s.getPropertyValue("right").slice(0,-2)),r=Number(s.getPropertyValue("left").slice(0,-2));if(Number.isNaN(m)||Number.isNaN(u))return!1;if(console.log("isBefore %o %o",{top:u,right:m,left:r,scrollX:l,scrollY:c}),u<=a&&m<=a)return!0}return!1}export{Ae as default};

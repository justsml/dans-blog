import{j as t}from"./jsx-runtime.CDeAccHH.js";import{n as W}from"./router.B-sij-_X.js";import{r}from"./index.CQ67ZF3f.js";import{c as X}from"./index.DwjnvRKN.js";import{s as J}from"./pathHelpers.kwYD5byA.js";import{g as K,Q as v}from"./QuestionStore.DE3R8U0_.js";import{B as z}from"./index.BkFtJHUr.js";import{P as U,a as Z,b as ee}from"./popover.BCPc0Y9B.js";import{a as te,c as q}from"./index.BvS0xTV7.js";import"./index.D2MAbzvX.js";import"./_commonjsHelpers.Cpj98o6Y.js";import"./index.CrqKlRvK.js";const se=r.createContext({answers:[],setAnswers:()=>{},currentChallenge:0,setCurrentChallenge:()=>{},totalQuestions:0,setTotalQuestions:()=>{},correctAnswers:0,setCorrectAnswers:()=>{}});function ne({hint:d,className:l,title:o,showHint:u,onClose:i}){return u&&console.log(`Showing Hint: ${d}`),t.jsxs(U,{"data-align":"end",open:u,onOpenChange:a=>{a||i?.()},children:[t.jsx(Z,{}),t.jsx(ee,{className:te("w-80 opacity-90 hint-tooltip",l),children:t.jsxs("div",{className:"grid gap-4",onClick:a=>{a.stopPropagation(),a.preventDefault(),i?.()},children:[t.jsxs("div",{className:"inner-tooltip grid",children:[o&&t.jsx("h4",{className:"font-medium leading-none my-2",children:o}),t.jsx("p",{className:"text-sm text-muted-foreground my-0",children:d})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(z,{onClick:()=>i?.(),variant:"outline",children:"Dismiss"}),t.jsx(z,{onClick:()=>i?.(5),variant:"outline",children:"Hide next 5 Hints"})]})]})})]})}const m=K(),re=1.75;function Ce({children:d,title:l,group:o,question:u,options:i,explanation:a,index:f}){let n=null;const P="DanLevy.net",{setTotalQuestions:Q,setCorrectAnswers:L}=r.useContext(se),g=r.useRef(null),[p,N]=r.useState("untouched"),[C,k]=r.useState(void 0),[w,E]=r.useState(!1),[b,O]=r.useState(a),[R,y]=r.useState(0),[D,B]=r.useState(""),$=()=>{const e=document.querySelectorAll("main .challenge"),c=document.querySelectorAll("main .challenge.correct");Q(e?.length),L(c?.length),window?.__updateCounts()};r.useEffect(()=>{n||(n=v(m?.location.pathname));const e=m?.location?.pathname??"";B(P+e)},[m?.location?.pathname]),r.useEffect(()=>{if(n||(n=v(m?.location.pathname)),n){n.addQuestion({title:l,group:o,question:u,index:f});const e=n?.isCorrect({index:f})??void 0,c=n?.getTries({index:f})??0;y(c),k(e),N(e===!0?"correct":e===!1?"incorrect":"")}else console.error("QuestionStore is not initialized")},[n,l,o,u,i,a]);const F=(e,c)=>{const h=m?.posthog;h&&h.capture(e,c)},V=1,[H,A]=r.useState(!1),[j,T]=r.useState(V),Y=e=>{n||(n=v(m?.location.pathname)),n?.answerQuestion({index:f},e),y(n.sumOfTries()),A(!1),e.isAnswer?(N("correct pulse"),k(!0)):(N("incorrect shake"),k(!1),j>0&&(console.log("Decrementing ignoreHintBy",j),T(j-1)),e.hint&&j<1&&A(e.hint)),F("QuizAnswer",{isCorrect:e.isAnswer,option:e,question:u||"",title:l,questionIndex:f}),setTimeout($,20)};r.useEffect(()=>{const e=p.includes("shake")||p.includes("pulse");if(p&&e){const c=p.split(" ").filter(h=>!["shake","pulse"].includes(h));setTimeout(()=>{N(c.join(" "))},1e3)}},[p]),r.useEffect(()=>{if(g.current){const e=g.current.querySelector("div.explanation")?.innerHTML;e&&O(e)}requestAnimationFrame(()=>{const e=g.current?.querySelector?.(".quiz-options");e&&e&&window?.__superHackFix_patchOptionsListWithActualHeight&&window?.__superHackFix_patchOptionsListWithActualHeight([e])})},[b,g]);const S=(f??0)+1;i.filter(e=>e.isAnswer).length===0&&console.error("No correct answers found for question:",u,l,i);const _=i.map(e=>{const c=C&&e.isAnswer;if(C&&!e.isAnswer)return null;const h=e.hint===H?H:!1;return t.jsxs("a",{className:X("option",{"correct-answer":c},"mx-auto"),onClick:()=>!C&&Y(e),children:[t.jsx("label",{children:e.text}),t.jsx(ne,{title:"ðŸ’¡ Hint",hint:h||"",showHint:!!h,onClose:s=>{s&&!isNaN(s)&&s>=1&&T(s),A(!1)}})]},e.text)}).filter(Boolean);return t.jsxs("div",{id:`qq-${S}`,className:q("challenge",p),ref:g,"data-answer-count":R,"data-question-correct":C,children:[t.jsxs("div",{className:"quiz-header",children:[t.jsxs("div",{className:"quiz-question-count",children:[t.jsxs("a",{href:`#qq-${S}`,children:[S,"."]}),"Â "]}),t.jsx("h2",{className:"quiz-title",id:J(l),children:t.jsx("a",{href:`#qq-${S}`,children:o})})]}),t.jsx("div",{className:"quiz-question",children:u||d}),t.jsxs("aside",{className:"quiz-hint-toggle",children:[t.jsx("div",{className:"watermark",children:D}),t.jsxs("button",{onClick:()=>E(!w),className:q("toggle-explainer",{open:w}),children:[w?"Hide":"Show"," Explainer"," "]})]}),t.jsxs("section",{className:q("quiz-body-panel","card-container",{"card-flip":w}),style:{height:`${re*70*_.length}px`,transition:"height 0.2s ease-in-out",overflowY:"auto"},children:[t.jsx("section",{className:"quiz-options card card-front",children:_}),t.jsx("section",{className:"explanation card card-back ",children:t.jsx("p",{className:"help-box",dangerouslySetInnerHTML:{__html:b},onClick:e=>{e.preventDefault();const{clientX:c,clientY:h}=e,s=e.target;console.log("Clicked on explanation",{clientX:c,clientY:h},s.tagName,s.getAttributeNames());const x=s.tagName==="A"?s:s?.parentElement?.tagName==="A"?s.parentElement:null,G=oe({target:s},48),I=s.closest("code, pre"),M=s.closest("p");if(G)return E(!1),!1;if(M)return console.log("Clicked in paragraph %o",s),!1;if(I)return console.log("Clicked in code block %o",s),!1;if(x)return W(x.href,{sourceElement:x}),console.log("Clicked on link",x,x?.href),!0}})})]})]})}function oe({target:d},l=48){if(!d)return!1;const o=getComputedStyle(d,"::before"),{scrollY:u,scrollX:i}=m;if(o){const a=Number(o.getPropertyValue("top").slice(0,-2)),f=Number(o.getPropertyValue("right").slice(0,-2)),n=Number(o.getPropertyValue("left").slice(0,-2));if(Number.isNaN(f)||Number.isNaN(a))return!1;if(console.log("isBefore %o %o",{top:a,right:f,left:n,scrollX:i,scrollY:u}),a<=l&&f<=l)return!0}return!1}export{Ce as default};

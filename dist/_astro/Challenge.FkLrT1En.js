import{j as s}from"./jsx-runtime.vlAWDSmm.js";import{n as Y}from"./router.B-sij-_X.js";import{r as n}from"./index.BwNzhqGF.js";import{c as $}from"./index.BQXz43h1.js";import{s as F}from"./pathHelpers.kwYD5byA.js";import{g as M,Q as S}from"./QuestionStore.DoXL2Hea.js";import{c as j}from"./clsx.B-dksMZM.js";import"./_commonjsHelpers.Cpj98o6Y.js";const X=n.createContext({answers:[],setAnswers:()=>{},currentChallenge:0,setCurrentChallenge:()=>{},totalQuestions:0,setTotalQuestions:()=>{},correctAnswers:0,setCorrectAnswers:()=>{}}),u=M(),G=1.75;function re({children:x,title:a,group:i,question:l,options:f,explanation:h,index:c}){let t=null;const y="DanLevy.net",{setTotalQuestions:z,setCorrectAnswers:v}=n.useContext(X),p=n.useRef(null),[m,C]=n.useState("untouched"),[N,A]=n.useState(void 0),[w,q]=n.useState(!1),[E,Q]=n.useState(h),[_,b]=n.useState(0),[L,H]=n.useState(""),P=()=>{const e=document.querySelectorAll("main .challenge"),r=document.querySelectorAll("main .challenge.correct");z(e?.length),v(r?.length),window?.__updateCounts()};n.useEffect(()=>{t||(t=S(u?.location.pathname));const e=u?.location?.pathname??"";H(y+e)},[u?.location?.pathname]),n.useEffect(()=>{if(t||(t=S(u?.location.pathname)),t){t.addQuestion({title:a,group:i,question:l,index:c});const e=t?.isCorrect({index:c})??void 0,r=t?.getTries({index:c})??0;b(r),A(e),C(e===!0?"correct":e===!1?"incorrect":"")}else console.error("QuestionStore is not initialized")},[t,a,i,l,f,h]);const R=(e,r)=>{const d=u?.posthog;d&&d.capture(e,r)},O=e=>{t||(t=S(u?.location.pathname)),t?.answerQuestion({index:c},e),b(t.sumOfTries()),e.isAnswer?(A(!0),C("correct pulse")):(A(!1),C("incorrect shake")),R("QuizAnswer",{isCorrect:e.isAnswer,option:e,question:l||"",title:a,questionIndex:c}),setTimeout(P,20)};n.useEffect(()=>{const e=m.includes("shake")||m.includes("pulse");if(m&&e){const r=m.split(" ").filter(d=>!["shake","pulse"].includes(d));setTimeout(()=>{C(r.join(" "))},1e3)}},[m]),n.useEffect(()=>{if(p.current){const e=p.current.querySelector("div.explanation")?.innerHTML;e&&Q(e)}requestAnimationFrame(()=>{const e=p.current?.querySelector?.(".quiz-options");e&&window?.__superHackFix_patchOptionsListWithActualHeight([e])})},[E,p]);const k=(c??0)+1;f.filter(e=>e.isAnswer).length===0&&console.error("No correct answers found for question:",l,a,f);const T=f.map(e=>{const r=N&&e.isAnswer;return N&&!e.isAnswer?null:s.jsx("a",{className:$("option",{"correct-answer":r}),onClick:()=>!N&&O(e),children:s.jsx("label",{children:e.text})},e.text)}).filter(Boolean);return s.jsxs("div",{id:`qq-${k}`,className:j("challenge",m),ref:p,"data-answer-count":_,"data-question-correct":N,children:[s.jsxs("div",{className:"quiz-header",children:[s.jsxs("div",{className:"quiz-question-count",children:[s.jsxs("a",{href:`#qq-${k}`,children:[k,"."]}),"Â "]}),s.jsx("h2",{className:"quiz-title",id:F(a),children:i})]}),s.jsx("div",{className:"quiz-question",children:l||x}),s.jsxs("aside",{className:"quiz-hint-toggle",children:[s.jsx("div",{className:"watermark",children:L}),s.jsxs("button",{onClick:()=>q(!w),className:j("toggle-explainer",{open:w}),children:[w?"Hide":"Show"," Explainer"," "]})]}),s.jsxs("section",{className:j("quiz-body-panel","card-container",{"card-flip":w}),style:{height:`${G*70*T.length}px`,transition:"height 0.2s ease-in-out",overflowY:"auto"},children:[s.jsx("section",{className:"quiz-options card card-front",children:T}),s.jsx("section",{className:"explanation card card-back ",children:s.jsx("p",{className:"help-box",dangerouslySetInnerHTML:{__html:E},onClick:e=>{e.preventDefault();const{clientX:r,clientY:d}=e,o=e.target;console.log("Clicked on explanation",{clientX:r,clientY:d},o.tagName,o.getAttributeNames());const g=o.tagName==="A"?o:o?.parentElement?.tagName==="A"?o.parentElement:null,B=W({target:o},48),D=o.closest("code, pre"),V=o.closest("p");if(B)return q(!1),!1;if(V)return console.log("Clicked in paragraph %o",o),!1;if(D)return console.log("Clicked in code block %o",o),!1;if(g)return Y(g.href,{sourceElement:g}),console.log("Clicked on link",g,g?.href),!0}})})]})]})}function W({target:x},a=48){if(!x)return!1;const i=getComputedStyle(x,"::before"),{scrollY:l,scrollX:f}=u;if(i){const h=Number(i.getPropertyValue("top").slice(0,-2)),c=Number(i.getPropertyValue("right").slice(0,-2)),t=Number(i.getPropertyValue("left").slice(0,-2));if(Number.isNaN(c)||Number.isNaN(h))return!1;if(console.log("isBefore %o %o",{top:h,right:c,left:t,scrollX:f,scrollY:l}),h<=a&&c<=a)return!0}return!1}export{re as default};
